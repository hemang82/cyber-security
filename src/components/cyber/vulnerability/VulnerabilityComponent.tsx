"use client"

import { formatDate, safeText, TOAST_ERROR, TOAST_SUCCESS } from "@/common/commonFunction";
import { DATE_FORMAT } from "@/common/commonVariable";
import { CODES } from "@/common/constant";
import DynamicTable from "@/components/tables/DynamicTable";
import Pagination from "@/components/tables/Pagination";
import Badge from "@/components/ui/badge/Badge";
import { useRouter } from "next/navigation";
import React, { useEffect, useState } from "react";
import { IoMdRefresh } from "react-icons/io";
import { CyberColorClass, severityColor } from "../Inventory/InventoryDetailsComponent";

// export const metadata: Metadata = {
//   title: "Next.js Basic Table | Cyber Admin - Next.js Dashboard Template",
//   description: "This is Next.js Basic Table  page for Cyber Admin  Tailwind CSS Admin Dashboard Template",
//   // other metadata
// };

export default function VulnerabilityComponent({ resVulnerabilityList, resDomainList }: any) {

    const [vulnerability, setVulnerability] = useState(resVulnerabilityList);

    console.log('resVulnerabilityList', resVulnerabilityList);

    const router = useRouter();
    const [refreshingId, setRefreshingId] = useState<number | null>(null);

    interface Order {
        // vulnerabilities: {
        //     values: string[];
        // }
        domin: string;
        txt_record: string;
        status?: string
    }

    const data: Order[] = [
        {
            domin: "https://ipo-trend.com/",
            txt_record: "asfghjkl1234567890qwertyuiop",
            status: "verified"
        },
        {
            domin: "Domin",
            txt_record: "asfghjkl1234567890qwertyuior",
            status: "pending"
        }
    ];

    const statusClasses: any = {
        pending: "bg-yellow-100 text-yellow-700",
        verified: "bg-green-100 text-green-700",
        cancelled: "bg-red-100 text-red-700",
    };

    const columns = [
        {
            key: "id",
            title: "Id",
        },
        {
            key: "target_url",
            title: "Target URL",
        },
        {
            key: "type",
            title: "Type",
            // render: (row: Order) => (
            //   <div className="flex items-center gap-3">
            //     <Image
            //       src={row.user.image}
            //       width={40}
            //       height={40}
            //       alt={row.user.name}
            //       className="rounded-full"
            //     />
            //     <div>
            //       <div className="font-medium text-gray-800 dark:text-white/90">
            //         {row.user.name}
            //       </div>
            //       <div className="text-xs text-gray-500">{row.user.role}</div>
            //     </div>
            //   </div>
            // ),
        },
        {
            key: "detail",
            title: "Detail",
            // render: (row: any) => (
            //     // <div className="">
            //     //     <span className="inline-flex items-center justify-center rounded-full bg-brand-100 px-3 py-1 text-xs font-medium text-brand-600 dark:bg-gray-800 dark:text-gray-200">
            //             {row.txt_record}
            //     //     </span>
            //     // </div>
            // ),
        },
        {
            key: "serverity", title: "Serverity",
            render: (row: any) => (
                // <Badge size="sm" color={row.risk_level && severityColor(row.risk_level) || '12'}>
                //   {row.risk_level || "Warning"}
                // </Badge>
                <span
                    className={`rounded-full px-2 py-0.5 text-md font-medium ${severityColor(row?.severity)} `} >
                    {safeText(row?.severity) || "N/A"}
                </span>
            ),
        },
        {
            key: "created_at", title: "Created",
            render: (row: any) => (
                <span>{formatDate(row.created_at, DATE_FORMAT?.FULL_DAY_MONTH_YEAR)}</span>
            ),
        },
    ];

    const [page, setPage] = useState(1);
    const [perPage, setPerPage] = useState(15);

    // Calculate paginated data
    const startIndex = (page - 1) * perPage;
    const currentData = vulnerability.slice(startIndex, startIndex + perPage);

    useEffect(() => {
        setVulnerability(resVulnerabilityList);
    }, [resVulnerabilityList]);

    return (<>
        <DynamicTable columns={columns} data={currentData} />
        {/* PAGINATION */}
        <Pagination
            currentPage={page}
            perPage={perPage}
            totalCount={vulnerability.length}
            onChange={(newPage, newPerPage) => {
                setPage(newPage);
                setPerPage(newPerPage);
            }}
        />
    </>);
}
